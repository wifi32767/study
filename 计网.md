# 第一章
## 1.1 计算机网络概述
### 计算机网络的概念
资源共享 信息传递 自治

### 计算机网络的组成
从组成部分看：硬件 软件 协议
从工作方式看：边缘部分（供用户使用的主机） 核心部分（网络和路由器）  
从功能组成看：通信子网 资源子网
- 其中，通信子网对应于低三层（物理层、数据链路层、网络层），资源子网对应于高三层（会话层、表示层、应用层）

### 计算机网络的功能
数据通信 资源共享 分布式处理(利用空闲资源提高系统利用率) 提高可靠性 负载均衡

### 计算机网络的分类
##### 按分布范围分类
广域网(WAN)、城域网(MAN)、局域网(LAN)、个人局域网(PAN)

##### 按传输技术分类
广播式网络 所有计算机共享一个公共信道
- 局域网基本都采用广播式通信技术

点对点网络 每条线路连接一对计算机  
两台主机没有直接连接，就需要中间节点  
- 广域网基本都属于点对点传输

区别在于是否采用分组存储转发与路由选择机制

##### 按拓扑结构分类
主要分为总线形、星形、环形、网状

##### 按使用者分类
公用网、专用网

##### 按交换技术分类
###### 电路交换
优点：
- 通信时延小
- 有序传输
- 没有冲突
- 适用范围广
- 实时性强
- 控制简单

缺点：
- 建立连接时间长
- 线路独占，使用率低
- 灵活性差
- 难以规格化

###### 报文交换
优点：
- 无需建立连接
- 动态分配线路
- 提高线路可靠性
- 提高线路利用率
- 提供多目标服务

缺点：
- 引起转发时延
- 需要较大缓存空间
- 需要传输额外的信息量

###### 分组交换
优点：
- 无需建立连接
- 提高线路利用率高
- 加速传输
- 减少出错概率和重发数据量

缺点：
- 引起转发时延
- 需要传输额外的信息量
- 对于数据报服务，存在失序、丢失、重复分组的问题
- 对于虚电路服务，存在呼叫建立、数据传输、虚电路释放三个过程

##### 按传输介质分类
分为有线和无线两大类，可以向下细分

### 计算机网络的性能指标  
##### 数据量
单位b，8bit = 1B，KB = $2^{10}$B

##### 速率(数据率)
单位b/s，kb/s = $10^3$b/s

##### 带宽
最高数据率，单位b/s

##### 时延
- 发送时延 = 分组长度 / 信道宽度
- 传播时延 = 信道长度 / 传播速率
- 处理时延
- 排队时延
排队时延和处理时延一般忽略不计  

##### 时延带宽积
发送端发送的第一个比特到达终点时，发送端发送了多少比特  
传播时延 * 信道带宽

##### 往返时延(RTT)
从发送端发送数据开始，到发送端受到来自接收端的确认经历的时延

##### 吞吐量
单位时间内通过某个网络的数据量

##### 信道利用率
某一信道有百分之多少的时间是有数据通过的

## 1.2 计算机网络体系结构与参考模型
### OSI七层模型
- 应用层
  - 通过应用进程间的交互完成特定的网络应用
- 表示层
- 会话层
- 运输层
  - 如何解决进程之间基于网络的通信问题
  - 出现传输错误的时候如何处理
- 网络层
  - 如何标识个网络以及各网络中的各主机(IP地址)
  - 路由器如何进行转发分组，如何进行路由选择
- 数据链路层
  - 如何标识网络中的各主机(MAC地址)
  - 如何从信号表示的一连串比特流中区分出地址和数据
  - 如何协调各主机争用总线
- 物理层
  - 采用怎样的传输媒体
  - 采用怎样的物理接口
  - 使用怎样的信号表示0和1

OSI模型是法律上的国际标准
教学中一般采用五层模型

### TCP/IP四层模型
- 应用层
- 运输层
- 网际层
- 网络接口层

TCP/IP模型是事实上的国际标准

### 一些概念
实体
- 任何可发送或接收信息的硬件或软件进程

对等实体
- 收发双方相同层次中的实体

协议
- 控制两个对等实体进行逻辑通信的规则的集合
- 语法
  - 定义交换信息的格式
- 语义
  - 定义收发双方要完成的操作
- 同步
  - 定义收发双方的时序关系

服务
- 在协议的控制下，两个对等实体间的逻辑通信可以向上一层提供服务，协议是水平的，服务是垂直的
- 要实现本层协议要使用下一层提供的服务，下一层的协议对上一层的实体是透明的
- 服务可以按三种方式分类
  - 面向连接与无连接
  - 可靠与不可靠
  - 有应答和无应答

接口
- 同一结点内相邻两层间交换信息的连接点
- 同一结点相邻两层的实体通过服务访问点SAP进行交互。服务通过SAP提供给上层使用

端到端通信 点到点通信
- 直接相连的节点之间的通信称为点到点通信，它只提供一台机器到另一台机器的通信，不涉及程序或进程的概念
- 点到点通信不能保证数据传输的可靠性，也不能说明源主机与目的主机之间是哪两个进程在通信
- 端到端通信建立在点到点通信的基础上，是一段段的点到点通信信道构成的，比点到点通信更高一级的通信方式
- 物理层、数据链路层、网络层组成的通信子网提供点到点的服务，而传输层为网络中的主机提供端到端的通信

# 第二章
## 2.1通信基础
### 物理层基本概念
物理层的主要任务是确定与传输媒体的接口有关的一些特性，即机械特性、电气特性、功能特性、过程特性  
数据
- 传送信息的实体
- 传输方式分为串行传输和并行传输
  - 串行传输一般用于远距离，更加经济。并行传输用于近距离，更加快

信号
- 数据的电气或电磁表现

码元
- 用一个固定时长的信号波形表示一位k进制数字，这个时长内的信号称为k进制码元，时长称为码元宽度

数据通信系统分为信源、信道、信宿三部分。信源是发送数据的源头，信宿是接收数据的终点。发送端信源发送的信息要经过变换器转换成适合在信道上传输的信号，接收端经过反变换器转换成原始信息  
信道传输的信号分为基带信号和宽带信号。基带信号直接将0和1用电压表示，在数字信道上传输，称为基带传输。宽带信号将基带信号调制成模拟信号，在模拟信道上传输，称为宽带传输。
从通信双方的交互方式看，分为单工、半双工、全双工

速率
- 单位时间内传输的数据量
- 码元传输速率
  - 单位时间内数字通信系统传输的码元个数
  - 单位是波特，1波特表示每秒传输一个码元
- 信息传输速率
  - 单位时间内数字通信系统传输的二进制码元个数
  - 单位是比特/秒

带宽指信号的频带宽度，单位赫兹

### 香农定理 奈氏准则
##### 奈奎斯特定理
理想信道(没有噪声，带宽有限)的信道中，极限码元传输率为$2W$波特，其中$W$为带宽，单位为赫兹  
如果有V种不同的码元，极限数据传输率为$2Wlog_2V$
- 在任何信道中，码元传输速率有上限，超过上限会出现码间串扰问题，无法完全正确识别码元
- 信道频带越宽，就可以用更高速率进行码元有效传输
- 奈氏准则未对信息传输速率给出限制

要提高数据传输率，要设法使每个码元携带更多信息量。为此需要采用多元制的调制方法

##### 香农定理
信道极限数据传输率 = $Wlog_2(1 + S/N)$b/s
S为信道传输信号的平均功率，N为信道内部的高斯噪声功率，S/N为信噪比
信噪比 = $10log_{10}(S/N)$ 单位dB
- 信道的带宽和信噪比越大，信息极限传输速率越高
- 对一定的带宽和信噪比，信息传输速率的上限是确定的
- 只要信息传输速率低于极限速率，就能找到某种方法实现无差错传输
- 实际能达到的传输速率比极限速率低不少

### 编码与调制
来自信源的信号称为基带信号，其中往往包含低频分量或直流分量，许多信道不能传输。因此要对信号进行调制
调制分为两大类。一类仅对信道特性相适应，变换后仍是基带信号，这类称为基带调制，也称编码。另一类调制需要使用载波，把基带信号的频率范围转移到较高的频段，转换为模拟信号，经过调制后的信号称为带通信号，这个过程称为带通调制。

##### 常用编码方式
!["编码方式"](img/计网/编码方式.jpg)
归零制：正脉冲代表1，负脉冲代表0
不归零制：正电平代表1，负电平代表0
曼彻斯特编码：为周期中心的向上跳变代表1，向下跳变代表0。可以反过来定义
差分曼彻斯特编码：每一位的中心市场中有跳变。位开始边界有跳变代表0，否则代表1

##### 基本带通调制方法
调幅：载波的振幅随基带数字信号而变化
调频：载波的频率随基带数字信号而变化
调相：载波的初始相位随基带数字信号而变化
为了达到更高的信息传输速率。必须采用更为复杂的多元制的混合调制方法，例如正交振幅调制
因为相位和频率是相关的，一次只能调制一个。通常将相位和振幅结合起来调制，称为正交振幅调制

### 信道复用技术
信道复用技术是指在一个信道上同时传输多路信息。常见的信道复用技术有时分复用、频分复用、波分复用、码分复用。
频分复用：用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。例如，有N路信号要在一个信道中传送。可以使用调制的方法，把各路信号分别搬移到适当的频率位置，使彼此不产生干扰
时分复用：将时间划分为若干个时间片，每个时间片只传输一路信号
这两种复用方法的优点是技术比较成熟，但缺点是不够灵活。
波分复用就是光的频分复用。由于光载波的频率很高，因此习惯上用波长而不用频率来表示所使用的光载波。这样就产生了波分复用这一名词。
码分复用：将数据划分为若干个码元，每个码元只传输一路信号。优点是可以同时传输多路信号，缺点是占用信道资源过多

### 数据报与虚电路
| | 数据报服务 | 虚电路服务 |
| --- | --- | --- |
| 连接建立 | 不需要 | 需要 |
| 目的地址 | 每个分组都包括发送端和接收端的完整地址 | 仅在建立连接阶段使用，之后每个分组使用长度较短的虚电路号 |
| 分组顺序 | 不保证分组的有序到达 | 保证分组有序到达 |
| 可靠性 | 不保证可靠通信，可靠性由用户主机保证 | 可靠通信 |
| 对网络故障的适应性 | 出故障的节点丢失分组，其他分组路径选择变化时正常传输 | 所有经过故障节点的虚电路不能正常工作 |
| 差错处理和流量控制 | 由用户主机进行流量控制，不保证数据报的可靠性 | 可由分组交换网或用户主机负责 |

## 2.2传输介质
传输介质实际上不属于任何一层。非要定义的话，应该属于物理层之下
传输介质分为导向传输介质和非导向传输介质。在导向传输介质中，电磁波被导向沿着固体媒介传播。非导向传输介质指自由空间，一般是无线传输

### 双绞线
用两根绝缘铜导线绞合，可以减少电磁干扰。可以在外面加上一个金属丝编织的屏蔽层，有屏蔽层称为屏蔽双绞线STP，无屏蔽层称为UTP
双绞线价格便宜，是最常用的传输介质之一，在局域网和传统电话网中使用普遍。通信距离一般为几千米到数十千米。距离太远时，对模拟传输要用放大器放大衰减的信号，对数字传输要用中继器将失真的信号整形

### 同轴电缆
同轴电缆一般分为两类。
基带同轴电缆(50$\Omega$)传输基带数字信号，局域网中应用广泛。
宽带同轴电缆(75$\Omega$)传输宽带模拟信号，用于有线电视系统。
由于同轴电缆有外导体屏蔽层，其抗干扰特性优于双绞线，广泛用于传输较高速率的数据。传输距离更远，价格比双绞线贵

### 光纤
光纤由纤芯和包层构成。光线从高折射率的纤芯射向低折射率的包层时，入射角足够大就会发生全反射
不同角度入射的多束光线可以在同一条光纤中传输，这种光纤称为多模光纤。光脉冲在多模光纤中传输的时候会逐渐展宽，造成失真，因此多模光纤只适用于近距离传输
优点：
- 通信容量大
- 传输损耗小，远距离传输更经济
- 抗电磁和噪声干扰性好
- 保密性好，不易被窃听
- 体积小，重量轻

缺点：
- 割接需要专用设备
- 光电接口价格较贵

### 无线传输介质
无线电波
- 低频和中频频段主要利用地面波传输。高频和甚高频主要利用电离层反射

微波
- 直线传播，不能被电离层反射。可以采用天线塔地面接力通信，也可以卫星通信

红外线和激光

## 2.3物理层设备
### 中继器
又称转发器，主要功能是将信号整形并放大再发出去，以消除信号的失真和衰减。中继器简单廉价，理论上可以无限使用，但是会造成延迟。网络标准中对信号的延迟做了规定，中继器只能在一定范围内运作。在粗同轴电缆的以太网规范中，串联的中继器不能超过4个，这5段通信介质中只有3段可以挂接计算机，其余两段只能作为扩展通信范围的链路段。这就是所谓的5-4-3原则

### 集线器
集线器实际上是一个多端口的中继器，将输入的信号整形放大后输出到所有除输入端口外处于工作状态的端口。如果有多个端口输入，那么输入的时候会冲突，致使所有数据都无效

# 第三章
链路：从一个节点到相邻节点的一段物理线路，中间没有其他的交换节点  
数据链路：在一条链路上传输数据时，除需要链路本身，还需要一些必要的通信协议，把实现这些协议的硬件和软件加到链路上就构成了数据链路  
计算机中的网络适配器（网卡）及其驱动程序实现了这些协议。一般的网络适配器都包含了物理层和数据链路层这两层的功能  
帧：数据链路层对等实体之间在水平方向进行逻辑通信的协议数据单元  
协议数据单元的缩写是PDU  

## 3.1数据链路层的功能
### 封装成帧和透明传输
将网络层的分组封装成帧，以帧的格式传送。将一段数据添加首部和尾部，就构成了帧。  
首部和尾部中含有很多控制信息，其中一个重要的作用是确定帧的界限，即帧定界。  
帧同步指的是接收方应能从接收到的二进制比特流中区分帧的起始与终止，使用帧定界符标识帧的开始与结束。  
透明传输指不管传输数据是什么样的比特组合都应当能在链路上传输。如果数据中恰好出现于帧定界符相同的比特组合，要采取有效的措施解决这个问题。  

### 差错检测
数据在信道上传输时不可避免的会产生误码，用以使发送方确定接收方是否正确接收到起发送的数据的方法称为差错控制。通常这些错误可以分为位错和帧错。  
位错是指帧中某些位出现差错通常采用循环冗余校验发现位错，通过自动重传请求方式重传出错的帧  
帧错是指帧的丢失、重复、失序等错误  

### 可靠传输
对于不可靠传输服务，接收方的数据链路层丢弃有误码的帧即可。对于可靠传输服务，需要实现某种机制实现发送方发送什么，接收方都能正确收到。

数据链路层为网络层提供如下服务：
- *无确认的无连接服务*。源机器发送数据帧时不需要建立链路连接，目的机器受到数据帧不需发回确认。对丢失的帧，数据链路层不负责重发而交给上层处理。适合实时通信或误码率低的信道，如以太网
- *有确认的无连接服务*。源机器发送数据帧时不需要建立链路连接，目的机器收到数据帧后发回确认。源机器在规定时间内未收到确定信号，就重传丢失的帧，提高传输的可靠性。适合误码率较高的通信信道，如无线通信
- *有确认的面向连接服务*。帧传输过程分为三个阶段：建立数据链路、传输帧、释放数据链路。目的机器对受到的每一帧都要给出确认，源机器收到确认才能发送下一帧。适用于通信要求较高的场合

### 流量控制
由于收发双方的处理能力不同，，可能出现发送方的发送能力大于接收方的接受能力的现象。数据链路层需要对发送方和接收方的发送速率进行协调，需要某种反馈机制使发送方知道接收方是否能跟上自己。流量控制并不是数据链路层特有的功能，许多高层协议也提供此功能，只不过控制的对象不同。对数据链路层来说，控制的是相邻两节点间数据链路上的流量。对运输层来说，控制的是从源端到目的端的流量

### 链路管理
数据链路层连接的建立、维持和释放过程称为链路管理，它主要用于面向连接的服务

## 3.2封装成帧
指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧。帧头和帧尾中包含重要的控制信息。  
帧头和帧尾的作用之一是帧定界。帧是网络中信息传输的最小单位，接收端收到的是一串比特流，需要首部和尾部正确区分帧。并不是每一种数据链路层协议都需要帧定界，有的协议可以直接在物理层区分帧。  

### 字符填充的首尾定界符法
字符填充法使用特定的字符定界一帧的开始和结束。为了使数据中出现的特殊字符不被误判，需要在其前面添加一个转义字符。对于数据中出现的转义字符，在其前面也添加转义字符

### 字符计数法
在帧头部使用一个计数字段标明帧内字符数，目的节点的数据链路层收到字节计数值，就能知道帧结束的位置。计数字段提供的字节数包含自身占用的一个字节

### 零比特填充的首尾标志法
零比特填充法用01111110标志一帧的开始和结束。发送方的数据链路层在信息位每遇到5个连续的1，在其后自动插入一个0。接收方做该过程的逆操作，每收到5个连续的0，就自动删除一个0

### 违规编码法

## 3.3差错控制
比特在传输过程可能会产生差错，称为比特差错。比特差错是传输差错的一种，传输差错还包括分组丢失、分组失序、分组重复，这些差错一般出现在上层。本节仅讨论比特差错  
通常用编码技术进行差错控制，主要有两类：自动重传请求ARQ和前向纠错FEC。ARQ中，接收端检测出差错时，就设法通知发送端重发，直到收到正确的数据。FEC中，接收端不但能发现差错，还能确定错误位置并纠正。因此差错检测又可分为检错编码和纠错编码

### 检错编码
##### 奇偶校验
最基本的检错码，由n-1位信息元和一位校验元组成。附加一位校验元后，码长位n的码字中1的个数为奇数/偶数

##### CRC校验
模二运算是一种二进制算法，不考虑进位和借位。模二乘除法与正常四则运算一样演算，但其中的部分积相加采用模二加，部分余数相减采用模二减  
循环冗余校验的过程如下：
1. 发送方和接收方在通信前，约定好一个预设整数作为除数。
2. 发送方在发送前根据原始数据和约定好的除数进行模二除法运算生成余数（即CRC码），然后将其附加到原始数据后面一起发送给接收方。
3. 接收方收到后将其模二除以约定好的除数，当且仅当余数为0时接收方认为没有差错。
这里所指的"将其附加到原始数据后面"，在校验的时候是将余数拼接到原始数据后面进行模二除

### 纠错编码
最常见的纠错编码是海明码  
设有k位数据，r位校验位，那么必须满足$k + r <= 2^r – 1$  
校验位处在$2^k$的位置上，第i位校验位表示第i位二进制位为1的所有数据按照奇偶校验配平的结果。  

## 3.4流量控制与可靠传输机制
### 可靠传输
使用差错检测技术可以检测出帧传输过程中是否产生误码  
如果提供不可靠传输服务，那么仅仅丢弃有误码的帧  
如果提供可靠传输服务，那么想办法实现发送端发送什么，接收端就收到什么。例如发送通知帧请求重发  
一般对于有线链路，误码率较低，为减少开销，不要求数据链路层提供可靠传输服务。可靠传输问题由上层处理  
无线链路易受干扰，误码率较高，因此数据链路层必须向上层提供可靠传输服务  
可靠传输服务不局限于数据链路层，其他各层均可选择实现可靠传输  

##### 停止-等待协议(SW)
发送方发送数据后，接收方收到后进行差错检测。若没有误码，发送确认分组ACK，发送方收到确认分组后才能发送下一个分组。若有误码，接收方发送否认分组NAK，发送方收到否认分组后重传该分组  
发送方发送完一个数据分组后启动一个超时计时器，超过一定时间后进行超时重传。一般将重传时间选为略大于从发送方到接收方的平均往返时间  
为了避免重复传输，必须为每个分组编号。因为每次只发送一个分组，因此编号只要与上次不同即可，只需要一个bit。同理，为了防止确认分组迟到，确认分组也需要编号  
对于数据链路层的点对点信道，往返时间比较固定，确认分组不会迟到，因此可以不用给确认分组编号  
接收方收到分组后，择机将接收到的数据递交给上层。发送方收到确认分组后，将该分组从缓存中删除  
设数据分组发送时间为$T_D$，确认分组发送时间$T_A$，往返时间$RTT$，信道利用率$U = \frac{T_D}{T_D + T_A + RTT}$，$RTT$远大于$T_D$时信道利用率非常低，因而诞生了另外两种协议  

##### 回退N帧协议(GBN)
如果发送方收到确认分组前可发送多个数据，可大大提高信道利用率。利用一个滑动窗口，设分组编号为k比特，尺寸为$n < 2 ^ k$，逐个发送窗口内的分组。接收方窗口大小为1
累计确认：接收方不一定要对收到的数据分组逐个发送确认，可以在收到几个数据分组后对按序到达的最后一个分组发送确认，表示其之前的所有数据分组都被正确接收。
优点：
- 即使确认分组丢失，发送方可能不必重传
- 减少了接收方的开销
缺点：
- 不能及时反映接收方正确接收的分组的信息

接收方收到损坏或窗口之外的分组后，将其丢弃并发送上一个接收到的分组的确认。发送方收到重复的确认，就知道之前发送的分组出错，可以立即超时重传。然而接收窗口大小只有1，一个数据分组的误码会导致后面多个分组不能被接收而丢弃，浪费通信资源

##### 选择重传协议(SR)
接收方窗口大小不再为1，以便接收方先收下失序到达但无误码且序号在接收窗口内的数据分组，等到所缺分组收起后一并送交上层，这就是选择重传协议  
为了使发送方仅重传出现拆哦的分组，接收方不能采用累计确认，而是逐一确认  
窗口尺寸必须满足$n <= 2 ^ (k - 1)$  

这三种协议实现的基本原理并不局限于数据链路层，可以应用到其他各层  

### 流量控制
发送方的发送速度大于接收方的接受速度，会导致数据丢失。数据链路层需要对发送方和接收方的发送速率进行协调，以便使发送方的发送速率不超过接收方的接受速率。流量控制是数据链路层的重要功能。  
流量控制的常见方法有两种：停止等待协议和滑动窗口协议，其原理和可靠传输的协议相同  